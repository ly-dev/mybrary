<?php
/**
 * Hook to manually map Facebook data to a Drupal user account upon connecting.
 *
 * This hook is fired before a Drupal user account is created by the Facebook
 * OAuth module.
 *
 * @param $edit
 *   A user account array, not yet including the UID. Make modifications to this
 *   array if other modules will then save this information for you in
 *   hook_user_presave() or hook_user_insert().
 * @param $fbuser
 *   The Facebook user account. Note that the contents of this object may change
 *   depending on what access the user has granted.
 * @return
 *   None. Modify the $edit array by reference.
 *
 * @see hook_fboauth_user_save()
 */
function mybrary_facebook_fboauth_user_presave(&$edit, $fbuser) {
    if (isset($fbuser->name)) {
        $edit['field_full_name'] = array(
                LANGUAGE_NONE => array(
                        array('value'=>$fbuser->name)
                )
        );
    }
}

/**
 * Implements hook_field_attach_submit ($entity_type, $entity, $form, &$form_state, $options = array())
 */
function mybrary_user_field_attach_submit ($entity_type, $entity, $form,
        &$form_state, $options = array())
{
    // Copy top-level form values that are for fields to entity properties
    if ($entity_type == 'user') {

        $fields_values = array_intersect_key($form_state['input'],
                field_info_instances($entity_type, 'user'));

        foreach ($fields_values as $key => $value)
        {
            switch ($key)
            {
                default:
                    $entity->$key = $value;
            }
        }
    }
}